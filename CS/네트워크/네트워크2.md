**책 모두의 네트워크 10일만에 배우는 네트워크 기초(길벗)를 참고로 공부하고 정리한 내용입니다.**

# 네트워크 2

---

## 전송 계층

### 전송 계층의 역할

- 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요
- 오류 점검 기능
  - 오류 발생시 데이터 재전송 요청
- 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능
  - 데이터가 올바르게 전송되고 사용되려면 올바른 목적지와 해당 데이터를 필요로하는 애플리케이션에 제대로 전달되어야 함(웹 브라우저인지 다른 프로그램인지 등)
- 전송 계층의 특징
  - 신뢰성(정확성), 효율성(데이터를 빠르게 전달하는 것)

### 연결형 / 비연결형 통신

- 연결형 통신: 신뢰할 수 있고 정확한 데이터 전달(신뢰성 우선)
  - 상대방과 확인해가며 통신
  - TCP 프로토콜 사용
- 비연결형 통신: 효율적으로 데이터 전달(효율성 우선)
  - 일방적인 데이터 전송
  - 동영상을 볼 때는 데이터 전송을 빠르게 하는 것이 중요하기 때문에 이를 사용
  - UDP 프로토콜 사용

### TCP

- 연결형 통신 프로토콜

- **TCP 헤더**: TCP로 전송할 때 붙이는 헤더

  > 1. 출발지 포트 번호(16비트)
  > 2. 목적지 포트 번호(16비트)
  > 3. 일련번호(32비트)
  > 4. 확인 응답 번호(32비트)
  > 5. 헤더 길이(4비트)
  > 6. 예약 영역(6비트)
  > 7. 코드 비트(6비트)
  >    - URG, ACK, PSH, RST, SYN, FIN이 각각 1비트씩 차지
  >    - 초기값은 0, 활성화되면 1로 변경
  > 8. 윈도우 크기(16비트)
  > 9. 체크섬(16비트)
  > 10. 긴급 포인터(16비트)
  > 11. 옵션
  >
  > 참고 설명
  >
  > [TCP의 헤더에는 어떤 정보들이 담겨있는걸까?](https://evan-moon.github.io/2019/11/10/header-of-tcp/)

- **세그먼트(segment)**: TCP헤더가 붙은 데이터

- TCP 통신에서 데이터 전송을 위해서는 **연결(connection)**이라는 가상 독점 통신로를 확보해야 함

- 연결 확립을 위해 SYN(연결 요청), ACK(확인 응답) 필요

**3-way 핸드셰이크**

1. 통신을 위해 컴퓨터 1은 컴퓨터 2에 SYN을 보냄
2. 컴퓨터 2는 요청을 받은 후 허가 응답으로 ACK를 보냄과 동시에 SYN을 보냄
3. 컴퓨터 1도 허가 응답으로 ACK를 보냄

- 각 단계들에서 요청이나 응답을 보내는 것은 해당 비트를 활성화 시키는 것
- 데이터를 보내기 전 연결 확립을 위해 패킷 요청을 세 번 교환하는 것을 3-way 핸드셰이크라 함
- 연결을 끊을 때는 FIN과 ACK 사용

1. 컴퓨터 1이 컴퓨터 2에게 FIN을 보냄
2. 컴퓨터 2는 종료 응답으로 ACK를 보냄
3. 컴퓨터 2도 FIN을 보냄
4. 컴퓨터 1도 종료 응답으로 ACK를 보냄

- 위에서도 각 단계별로 해당 비트가 활성화됨

### 일련번호와 확인 응답 번호

- 3-way 핸드셰이크가 끝나고 실제 데이터를 송수신할 때는 일련번호와 확인 응답 번호가 사용됨
- TCP는 데이터를 분할해서 보냄. 이와 관련된 정보들을 주는 것이 두 번호.
- 일련번호
  - 송신  측에서 수신 측에 해당 데이터가 몇 번째 데이터인지 알려줌
- 확인 응답 번호
  - 수신 측에서 송신 측에 몇 번째 데이터를 수신했는지 알려줌
  - 다음 데이터를 요청하는 데에도 사용됨(이러한 다음 데이터 요청을 확인 응답이라 함)
  - 3-way 핸드셰이크로 연결이 확립될 때 일련번호와 호가인 응답 번호가 결정됨

1. 컴퓨터 1이 컴퓨터 2에게 200바이트의 데이터를 전송(예: 일련번호 3001, 확인 응답 번호 4001)
2. 컴퓨터 2가 다음 수신하려는 데이터 번호를 확인 응답 번호에 넣고 받은 확인 응답 번호는 일련번호에 넣어서 보냄(일련번호 4001, 확인 응답 번호 3201(200바이트를 줬으므로 그 다음번 데이터는 3201이 됨))
3. 데이터가 모두 전송될 때까지 이를 반복

- 중간에 데이터가 손상되거나 유실되면 재전송. 이를 재전송 제어라 함. 전송 도중 오류가 발생하면 일정 시간 기다린 후 데이터 재전송
- 이렇게 데이터를 보낼 때마다 응답을 반환하는 방식은 효율이 높지 않음. 따라서 세그먼트를 연속해서 보낸 다음 확인 응답을 반환하는 방법을 사용

**윈도우 크기**

- 여러 세그먼트를 보내고 확인 응답을 받으려면 우선 하나의 세그먼트에 대한 응답이 처리될 동안 세그먼트를 보관할 장소가 있어야 함. 이를 **버퍼(buffer)**라고 함
- 버퍼 크기 이상으로 데이터가 들어오면 오버플로우(overflow)가 발생
- 오버플로우 발생 방지를 위해 3-way 핸드셰이크를 할 때 컴퓨터가 서로 윈도우의 크기(버퍼의 한계 크기, 데이터를 저장해둘 수 있는 최대 용량)를 주고받음. 이를 토대로 버퍼 한계를 넘어가지 않는 선에서 세그먼트 전송